<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>M√¥ h√¨nh s·ª± chuy·ªÉn th·ªÉ ƒë·∫≥ng c·∫•p</title>
<style>
  :root{
    --bg-1:#1b0710;
    --bg-2:#2b0a1a;
    --ui:#ffd7ec;
    --accent:#ff6fb1;
  }
  html,body{
    margin:0;height:100%;
    background:linear-gradient(180deg,var(--bg-1),var(--bg-2));
    color:var(--ui);
    font-family:Inter,system-ui,sans-serif;
    display:flex;flex-direction:column;align-items:center;
  }
  h1{
    font-size:24px;font-weight:800;margin:12px 0;
    animation:rainbow 6s linear infinite;
  }
  @keyframes rainbow{
    0%{color:red;}15%{color:orange;}30%{color:yellow;}
    45%{color:green;}60%{color:blue;}75%{color:violet;}
    90%{color:pink;}100%{color:black;}
  }
  button{
    background:linear-gradient(180deg,var(--accent),#c64586);
    border:0;border-radius:10px;color:#fff;font-weight:700;
    padding:8px 16px;margin:0 6px;cursor:pointer;
    transition:transform 0.2s;
  }
  button:hover{transform:scale(1.05);}
  #tempLabel{font-size:14px;margin-left:10px;}
  #sketch-holder{box-shadow:0 20px 60px rgba(0,0,0,0.5);border-radius:14px;overflow:hidden;}
  footer{margin:14px;color:#ffcfe6;font-size:13px;}
  #decorCanvas{
    position:absolute;top:0;left:0;width:100%;height:100%;
    pointer-events:none;
  }
</style>
</head>
<body>
  <h1>M√¥ h√¨nh s·ª± chuy·ªÉn th·ªÉ ƒë·∫≥ng c·∫•p</h1>
  <div>
    <button id="btnCool">-5 ƒë·ªô</button>
    <button id="btnHeat">+5 ƒë·ªô</button>
    <button id="btnReset" class="ghost">Reset</button>
    <span id="tempLabel">T = 20.0 ¬∞C</span>
  </div>
  <div id="sketch-holder"></div>
  <canvas id="decorCanvas"></canvas>
  <footer>0¬∞C ‚Üí ƒë√¥ng ƒë·∫∑c | 100¬∞C ‚Üí bay h∆°i | Hello Kitty thay ƒë·ªïi bi·ªÉu c·∫£m theo nhi·ªát ƒë·ªô üê±</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
<script>
let temperature=20;
let ly={x:350,y:330,w:140,h:200,nuocH:120,state:"liquid"};
let hoiNuoc=[], molecules=[], solidGrid=[];
let currentSpeed=0, targetSpeed=0;
let boxLabel="Ph√¢n t·ª≠ trong th·ªÉ l·ªèng ‚Äì dao ƒë·ªông quanh v·ªã tr√≠ c√¢n b·∫±ng kh√¥ng x√°c ƒë·ªãnh";
const box={x:650,y:330,w:180,h:180};
let decorCtx,snowflakes=[],clouds=[];

function setup(){
  let cnv=createCanvas(900,600);
  cnv.parent("sketch-holder");
  initDecorCanvas();
  document.getElementById("btnCool").onclick=()=>doiNhiet(-5);
  document.getElementById("btnHeat").onclick=()=>doiNhiet(5);
  document.getElementById("btnReset").onclick=resetSim;
  initMolecules();initSolidGrid();
  for(let i=0;i<30;i++){snowflakes.push({x:random(900),y:random(600),r:random(2,4)});}
  for(let i=0;i<3;i++){clouds.push({x:random(0,900),y:random(50,150),w:random(80,140)});}
}

function initDecorCanvas(){
  let decor=document.getElementById("decorCanvas");
  decor.width=900;decor.height=600;
  decorCtx=decor.getContext("2d");
}

function doiNhiet(d){
  temperature+=d;
  document.getElementById("tempLabel").innerText=`T = ${temperature.toFixed(1)} ¬∞C`;
}
function resetSim(){
  temperature=20;ly.nuocH=120;hoiNuoc=[];
  initMolecules();initSolidGrid();
  currentSpeed=0;
  document.getElementById("tempLabel").innerText=`T = ${temperature.toFixed(1)} ¬∞C`;
}

/* ========== M√î PH·ªéNG PH√ÇN T·ª¨ GI·ªÆ NGUY√äN ========== */
function initMolecules(){
  molecules=[];
  for(let i=0;i<50;i++){
    molecules.push({
      x:box.x+random(-box.w/2+10,box.w/2-10),
      y:box.y+random(20,box.h/2-10),
      vx:random(-0.8,0.8),vy:random(-0.8,0.8),
      r:5,baseX:box.x+random(-60,60),baseY:box.y+random(20,60)
    });
  }
}
function initSolidGrid(){
  solidGrid=[];
  let startX=box.x-60,startY=box.y-60,spacing=25;
  for(let r=0;r<5;r++){for(let c=0;c<5;c++){
    solidGrid.push({x:startX+c*spacing,y:startY+r*spacing,r:5});
  }}
}

function draw(){
  background(25,6,16);
  drawLy();drawTrangThai();veHoiNuoc();
  drawMoleculeBox();updateMolecules();drawText();
  drawDecor();drawHelloKitty();
}

function drawLy(){
  push();noFill();stroke(255,180,220);strokeWeight(2);
  rectMode(CENTER);rect(ly.x,ly.y,ly.w,ly.h,15);pop();
}
function drawTrangThai(){
  if(temperature<=0){
    ly.state="solid";fill(255,200,230);
    rectMode(CENTER);
    rect(ly.x,ly.y+ly.h/2-ly.nuocH/2,ly.w-10,ly.nuocH,5);
  }else if(temperature<100){
    ly.state="liquid";fill(255,150,210,230);
    rectMode(CENTER);
    let wave=sin(frameCount*0.05)*5;
    rect(ly.x,ly.y+ly.h/2-ly.nuocH/2+wave,ly.w-12,ly.nuocH,5);
  }else{
    ly.state="gas";
    if(ly.nuocH>10) ly.nuocH-=0.3;
    fill(255,170,220,100);
    rectMode(CENTER);
    rect(ly.x,ly.y+ly.h/2-ly.nuocH/2,ly.w-12,ly.nuocH,5);
    if(random()<0.1)
      hoiNuoc.push({x:ly.x+random(-ly.w/3,ly.w/3),y:ly.y-ly.h/2+random(0,10),r:random(10,20),a:255});
  }
}
function veHoiNuoc(){
  for(let i=hoiNuoc.length-1;i>=0;i--){
    let h=hoiNuoc[i];noStroke();fill(255,220,245,h.a);
    ellipse(h.x,h.y,h.r,h.r*0.7);h.y-=0.8;h.a-=2;
    if(h.a<=0) hoiNuoc.splice(i,1);
  }
}

/* ========== H·ªòP PH√ÇN T·ª¨ GI·ªÆ NGUY√äN ========== */
function drawMoleculeBox(){
  push();noFill();stroke(255,180,220);strokeWeight(2);
  rectMode(CENTER);rect(box.x,box.y,box.w,box.h,15);
  noStroke();fill(255,200,230);textAlign(CENTER);textSize(13);
  text(boxLabel,box.x,230,160,80);pop();
}
function updateMolecules(){
  if(temperature<=0){
    targetSpeed=0.1;boxLabel="Ph√¢n t·ª≠ trong th·ªÉ r·∫Øn ‚Äì dao ƒë·ªông quanh v·ªã tr√≠ c√¢n b·∫±ng x√°c ƒë·ªãnh";
  }else if(temperature<100){
    targetSpeed=0.4;boxLabel="Ph√¢n t·ª≠ trong th·ªÉ l·ªèng ‚Äì dao ƒë·ªông quanh v·ªã tr√≠ c√¢n b·∫±ng kh√¥ng x√°c ƒë·ªãnh (·ªü d∆∞·ªõi ƒë√°y)";
  }else{
    targetSpeed=2.0;boxLabel="Ph√¢n t·ª≠ trong th·ªÉ kh√≠ ‚Äì chuy·ªÉn ƒë·ªông h·ªón lo·∫°n theo m·ªçi h∆∞·ªõng";
  }
  currentSpeed=lerp(currentSpeed,targetSpeed,0.03);
  if(temperature<=0){
    for(let p of solidGrid){
      let dx=sin(frameCount*0.1+p.x)*1.5, dy=cos(frameCount*0.1+p.y)*1.5;
      fill(255,150,210,230);ellipse(p.x+dx,p.y+dy,p.r*2,p.r*2);
    }
  }else if(temperature<100){
    for(let m of molecules){
      m.baseX+=sin(frameCount*0.002+m.y)*0.2;m.baseY+=cos(frameCount*0.002+m.x)*0.2;
      m.x += sin(frameCount*0.05+m.y)*0.3 + random(-0.3,0.3);
      m.y += cos(frameCount*0.05+m.x)*0.3 + random(-0.3,0.3);
      let bottomLimit=box.y+box.h/2-10;
      m.x=constrain(m.x,box.x-box.w/2+10,box.x+box.w/2-10);
      m.y=constrain(m.y,box.y,bottomLimit);
      fill(255,150,210,220);ellipse(m.x,m.y,m.r*2,m.r*2);
    }
  }else{
    for(let m of molecules){
      m.x+=m.vx*currentSpeed;m.y+=m.vy*currentSpeed;
      if(m.x<=box.x-box.w/2+8||m.x>=box.x+box.w/2-8)m.vx*=-1;
      if(m.y<=box.y-box.h/2+8||m.y>=box.y+box.h/2-8)m.vy*=-1;
      fill(255,150,210,200);ellipse(m.x,m.y,m.r*2,m.r*2);
    }
  }
}
function drawText(){
  fill(255,220,240);textSize(16);textAlign(CENTER);
  let tt="";
  if(temperature<=0)tt="TH·ªÇ R·∫ÆN ‚Äì PH√ÇN T·ª¨ DAO ƒê·ªòNG QUANH V·ªä TR√ç C√ÇN B·∫∞NG X√ÅC ƒê·ªäNH";
  else if(temperature<100)tt="TH·ªÇ L·ªéNG ‚Äì PH√ÇN T·ª¨ ·ªû D∆Ø·ªöI, DAO ƒê·ªòNG CH·ªíNG L·ªöP NH∆Ø N∆Ø·ªöC";
  else tt="TH·ªÇ KH√ç ‚Äì PH√ÇN T·ª¨ CHUY·ªÇN ƒê·ªòNG H·ªñN LO·∫†N M·ªåI H∆Ø·ªöNG";
  text(tt,width/2,40);
}

/* ========== TRANG TR√ç ========== */
function drawDecor(){
  decorCtx.clearRect(0,0,900,600);
  if(temperature<=0){drawSnow();drawSnowman();}
  else if(temperature<100){drawSun();}
  else{drawClouds();}
}
function drawSnow(){
  decorCtx.fillStyle="white";
  for(let f of snowflakes){
    decorCtx.beginPath();decorCtx.arc(f.x,f.y,f.r,0,Math.PI*2);
    decorCtx.fill();f.y+=0.7;if(f.y>600)f.y=0;
  }
}
function drawSnowman(){
  decorCtx.fillStyle="#fff";
  decorCtx.beginPath();
  decorCtx.arc(100,520,20,0,Math.PI*2);
  decorCtx.arc(100,490,15,0,Math.PI*2);
  decorCtx.arc(100,465,10,0,Math.PI*2);
  decorCtx.fill();
  decorCtx.fillStyle="orange";
  decorCtx.beginPath();
  decorCtx.moveTo(100,465);
  decorCtx.lineTo(115,468);
  decorCtx.lineTo(100,470);
  decorCtx.fill();
}
function drawSun(){
  let gradient=decorCtx.createRadialGradient(820,100,10,820,100,60);
  gradient.addColorStop(0,"#fff9c4");
  gradient.addColorStop(1,"rgba(255,221,0,0)");
  decorCtx.fillStyle=gradient;
  decorCtx.beginPath();decorCtx.arc(820,100,60,0,Math.PI*2);decorCtx.fill();
}
function drawClouds(){
  decorCtx.fillStyle="rgba(255,255,255,0.8)";
  for(let c of clouds){
    decorCtx.beginPath();
    decorCtx.ellipse(c.x,c.y,c.w,40,0,0,Math.PI*2);
    decorCtx.ellipse(c.x+40,c.y+10,c.w*0.6,35,0,0,Math.PI*2);
    decorCtx.ellipse(c.x-40,c.y+10,c.w*0.6,35,0,0,Math.PI*2);
    decorCtx.fill();
    c.x+=0.2;if(c.x>950)c.x=-100;
  }
}

/* ========== HELLO KITTY ========== */
function drawHelloKitty(){
  const x=800, y=500;
  push();
  translate(x,y);
  noStroke();
  if(temperature<=0){
    // L·∫†NH ‚Äì run c·∫ßm c·∫≠p
    fill(255);ellipse(0,0,70,60);
    fill(0);ellipse(-15,-5,5,5);ellipse(15,-5,5,5);
    fill("#ffb6c1");ellipse(0,10,8,5);
    fill("#ff69b4");ellipse(-20,-25,10,10);
    fill(255,255,255,150);
    textSize(14);text("ü•∂", -8, 5);
    if(frameCount%10<5)translate(random(-1,1),random(-1,1));
  }else if(temperature<40){
    // B√åNH TH∆Ø·ªúNG
    fill(255);ellipse(0,0,70,60);
    fill(0);ellipse(-15,-5,5,5);ellipse(15,-5,5,5);
    fill("#ffb6c1");ellipse(0,10,8,5);
    textSize(18);text("üò∫", -10, 8);
  }else if(temperature<100){
    // N√ìNG
    fill(255);ellipse(0,0,70,60);
    fill("#ff6347");ellipse(0,0,70,60);
    fill(0);ellipse(-15,-5,5,5);ellipse(15,-5,5,5);
    textSize(18);text("ü•µ", -10, 8);
    if(frameCount%30<15)translate(sin(frameCount*0.2)*2,0);
  }else{
    // X·ªàU
    fill(255,200,210,180);
    ellipse(0,10,70,40);
    textSize(18);text("üòµ", -10, 8);
  }
  pop();
}
</script>
</body>
</html>
